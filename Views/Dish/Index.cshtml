@model StarFood.Models.ViewModels.DishVM

@{
    ViewData["Title"] = "Platillos";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="~/css/index.css">
    <link rel="stylesheet" type="text/css" href="~/css/_sidebar.css">
</head>
<body>
    <div class="container mt-4">
        <div class="row mb-3 align-items-center">
            <div class="col-md-8">
                <h2 class="mb-0">@ViewData["Title"]</h2>
                <p class="text-muted">Aquí puedes ver todos tus platillos</p>
            </div>

            <div class="col-md-4 text-end">
                <button class="btn btn-outline-success w-100" data-bs-toggle="modal" data-bs-target="#AddDish">Agregar Platillo</button>
            </div>
            @await Html.PartialAsync("Create", new Platillo())
           

        <div class="row" id="dishCardsContainer">
            @foreach (var dish in Model.Dishes)
            {
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <img src="@dish.ImagenUrl" class="card-img-top" alt="@dish.Nombre">
                        <div class="card-body">
                            <h5 class="card-title">@dish.Nombre</h5>
                            <p class="card-text">@dish.Descripcion </p>
                            <p class="card-text"><strong>Precio:</strong> @dish.Precio.ToString("C")</p>
                            <p class="card-text"><strong>Categoría:</strong> @dish.Categoria.Nombre</p>
                            <p class="card-text"><strong>Suspendido:</strong> @(dish.Suspendido ? "Sí" : "No")</p>
                            <a href="@Url.Action("Edit", new { id = dish.IDPlatillo })" class="btn btn-primary">Editar</a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap Bundle (incluye Popper.js y Bootstrap JS) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap5.min.js"></script>
        <script src="~/js/newitem.js"></script>
        <script src="~/js/_sidebar.js"></script>
        <script src="~/js/index.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            // Cargar categorías cuando se abre el modal
            $('#AddDish').on('show.bs.modal', function () {
                $.ajax({
                    url: '@Url.Action("GetCategorias", "Dish")',
                    type: 'GET',
                    success: function (data) {
                        var $dropdown = $('#CategoriaDropdown');
                        $dropdown.empty();
                        $.each(data.data, function (key, entry) {
                            $dropdown.append($('<option></option>').attr('value', entry.idCategoria).text(entry.nombre));
                        });
                    }
                });
            });
                $('#createDishForm').on('submit', function (e) {
                    e.preventDefault();
                    var formData = new FormData(this); // Captura todos los datos del formulario, incluidos los archivos
                    console.log(formData);
                    $.ajax({
                        url: '@Url.Action("Create", "Dish")',
                        type: 'POST',
                        data: formData,
                        processData: false, // Necesario para enviar data como FormData
                        contentType: false, // Necesario para enviar data como FormData
                        success: function (response) {
                            if (response.success) {
                                alert('Imagen subida correctamente');
                                // Realizar alguna acción después de una carga exitosa
                            } else {
                                alert('Error: ' + response.errors.join(', '));
                                // Manejar errores según sea necesario
                            }
                        },
                        error: function (xhr, status, error) {
                            console.error('Error al subir la imagen:', error);
                        }
                    });
                });
            // Manejar el envío del formulario de creación de platillo
            // $('#createDishForm').on('submit', function (e) {
            //     e.preventDefault();
            //     var formData = $(this).serialize();
            //     $.ajax({

            //         type: 'POST',
            //         data: formData,
            //         success: function (response) {
            //             if (response.success) {
            //                 alert('Platillo creado correctamente');
            //                 location.reload(); // Recargar la página para ver el nuevo platillo
            //             } else {
            //                 alert('Error: ' + response.message);
            //             }
            //         }
            //     });
            // });
        });
    </script>
    <script type="text/javascript">
        tinymce.init({
            selector: 'textarea#Descripcion',
            apiKey: 'your-api-key', // Agrega tu API Key aquí
            height: 300,  // Altura del editor
            plugins: [
                'advlist autolink lists charmap print preview anchor',
                'searchreplace code fullscreen',
                'insertdatetime table paste code wordcount'
            ],
            toolbar: 'undo redo | alignleft aligncenter ' +
                'alignright alignjustify | bullist numlist outdent indent | ',
            content_style: 'body { font-family: Arial, Helvetica, sans-serif; font-size: 14px }'
        });

        // Resto del código jQuery...
    </script>


</body>
</html>

