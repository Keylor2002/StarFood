@using StarFood.Utility
@model IEnumerable<Platillo>

@{
    ViewData["Title"] = "Platillo Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4" id="div-container">
    <div class="rounded-box">
        <!-- SearchBox and AddButton -->
        <div class="row mb-3 align-items-center">
            <div class="col-md-10">
                <form class="d-flex" method="get" asp-action="Index">
                    <input class="form-control me-2" type="search" placeholder="Buscar por nombre" aria-label="Buscar" name="searchString">
                    <button class="btn btn-info" type="submit">Buscar</button>
                </form>
            </div>
            <div class="col-md-2">
                <a class="btn btn-info w-100" asp-action="Create">Crear</a>
            </div>
        </div>
        <!-- Table -->
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>@Html.DisplayNameFor(model => model.FirstOrDefault().Nombre)</th>
                        <th>@Html.DisplayNameFor(model => model.FirstOrDefault().Categoria.Nombre)</th>
                        <th>@Html.DisplayNameFor(model => model.FirstOrDefault().Precio)</th>
                        <th>@Html.DisplayNameFor(model => model.FirstOrDefault().Descripcion)</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@Html.DisplayFor(modelItem => item.IDPlatillo)</td>
                            <td>@Html.DisplayFor(modelItem => item.Nombre)</td>
                            <td>@Html.DisplayFor(modelItem => item.Categoria.Nombre)</td>
                            <td>@Html.DisplayFor(modelItem => item.Precio)</td>
                            <td>@Html.DisplayFor(modelItem => item.Descripcion)</td
                            <td>
                                <div class="dropdown">
                                    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-three-dots"></i>
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                        <li><a class="dropdown-item" asp-action="Edit" asp-route-id="@item.IDPlatillo">Editar</a></li>
                                        <li><a class="dropdown-item" href="#">Habilitar</a></li>
                                        <li><a class="dropdown-item" href="#">Deshabilitar</a></li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('.dropdown-menu a.dropdown-item').click(function () {
                var option = $(this).text().trim();
                var categoryId = $(this).closest('tr').find('td:first').text().trim(); // Obtener el ID de la categoría

                if (option === 'Editar') {
                    // Redirigir a la página de edición (reemplazar con la URL correcta)
                    window.location.href = '@Url.Action("Edit", "Category", new { id = "__categoryId__" })'.replace('__categoryId__', categoryId);
                } else if (option === 'Habilitar') {
                    // Lógica para habilitar la categoría (puedes hacer una solicitud AJAX aquí)
                    console.log('Habilitar categoría con ID: ' + categoryId);
                } else if (option === 'Deshabilitar') {
                    // Lógica para deshabilitar la categoría (puedes hacer una solicitud AJAX aquí)
                    console.log('Deshabilitar categoría con ID: ' + categoryId);
                }
            });
        });
    </script>

    @* Incluir los scripts de validación si es necesario *@
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
